<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Dodatki - VIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .baggage-icon, .extra-icon {
            font-size: 24px;
            color: #10b981;
            margin-bottom: 10px;
        }
        .selected {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.1);
        }
        .price {
            margin-top: 10px;
            font-weight: bold;
            color: #10b981;
            display: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 font-sans text-gray-800">
    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 py-3">
            <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium transition-colors">Zarezerwuj lot</a>
            <a href="#checkin" class="ml-6 text-blue-600 hover:text-blue-800 font-medium transition-colors">Odpraw siƒô</a>
            <a href="#manage" class="ml-6 text-blue-600 hover:text-blue-800 font-medium transition-colors">ZarzƒÖdzaj rezerwacjƒÖ</a>
        </nav>
    </header>
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="text-sm text-gray-500 mb-4" id="summary-text"></div>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Dodatki do Twojego lotu</h2>
        
        <!-- Baga≈º rejestrowany -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Baga≈º rejestrowany</h3>
            <div class="grid grid-cols-4 gap-4">
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('baggage', 10)">
                    <div class="baggage-icon">üß≥</div>
                    <span class="block text-sm font-medium">10kg</span>
                    <button class="select-btn mt-2 w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors" onclick="selectBaggage(10, event)">Wybierz</button>
                    <div class="price mt-2" id="price-10">Cena: 50 PLN</div>
                </div>
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('baggage', 15)">
                    <div class="baggage-icon">üß≥</div>
                    <span class="block text-sm font-medium">15kg</span>
                    <button class="select-btn mt-2 w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors" onclick="selectBaggage(15, event)">Wybierz</button>
                    <div class="price mt-2" id="price-15">Cena: 75 PLN</div>
                </div>
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('baggage', 20)">
                    <div class="baggage-icon">üß≥</div>
                    <span class="block text-sm font-medium">20kg</span>
                    <button class="select-btn mt-2 w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors" onclick="selectBaggage(20, event)">Wybierz</button>
                    <div class="price mt-2" id="price-20">Cena: 100 PLN</div>
                </div>
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('baggage', 25)">
                    <div class="baggage-icon">üß≥</div>
                    <span class="block text-sm font-medium">25kg</span>
                    <button class="select-btn mt-2 w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors" onclick="selectBaggage(25, event)">Wybierz</button>
                    <div class="price mt-2" id="price-25">Cena: 125 PLN</div>
                </div>
            </div>
        </div>

        <!-- Dodatkowe opcje -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Dodatkowe us≈Çugi</h3>
            <div class="grid grid-cols-3 gap-4">
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('insurance')">
                    <div class="extra-icon">üõ°Ô∏è</div>
                    <span class="block text-sm font-medium">Ubezpieczenie</span>
                    <button class="select-btn mt-2 w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" onclick="selectExtra('insurance', event)">Wybierz</button>
                    <div class="price mt-2" id="price-insurance">Cena: 30 PLN</div>
                </div>
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('priority')">
                    <div class="extra-icon">‚≠ê</div>
                    <span class="block text-sm font-medium">Priorytetowa odprawa</span>
                    <button class="select-btn mt-2 w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" onclick="selectExtra('priority', event)">Wybierz</button>
                    <div class="price mt-2" id="price-priority">Cena: 20 PLN</div>
                </div>
                <div class="text-center p-4 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer" onclick="selectExtra('windowSeat')">
                    <div class="extra-icon">ü™ü</div>
                    <span class="block text-sm font-medium">Miejsce przy oknie</span>
                    <button class="select-btn mt-2 w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" onclick="selectExtra('windowSeat', event)">Wybierz</button>
                    <div class="price mt-2" id="price-windowSeat">Cena: 15 PLN</div>
                </div>
            </div>
        </div>

        <!-- Przycisk Przejd≈∫ dalej -->
        <div class="mt-8 text-center">
            <a href="passenger-form.html" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors inline-block">Przejd≈∫ dalej</a>
        </div>
    </div>

    <script>
        // Pobieranie parametr√≥w z URL
        const urlParams = new URLSearchParams(window.location.search);
        const origin = urlParams.get('origin') || 'Nie wybrano';
        const destination = urlParams.get('destination') || 'Nie wybrano';
        const departure = urlParams.get('departure') || 'Nie wybrano';
        const returnDate = urlParams.get('return') || '';
        const passengers = urlParams.get('passengers') || '1 Pasa≈ºer, Ekonomiczna';
        const selectedClass = urlParams.get('class') || 'Ekonomi';
        const outboundFlightData = JSON.parse(decodeURIComponent(urlParams.get('outboundFlightData') || '{}'));
        const returnFlightData = urlParams.get('returnFlightData') ? JSON.parse(decodeURIComponent(urlParams.get('returnFlightData'))) : null;

        // Wy≈õwietlanie podsumowania
        document.getElementById('summary-text').textContent = `Rezerwacja: ${origin} ‚Üí ${destination}, ${departure}${returnDate ? `, Powr√≥t: ${returnDate}` : ''}, ${passengers}, Klasa: ${selectedClass}`;

        // Obliczanie kosztu bilet√≥w
        function calculateTicketPrice(flightData) {
            if (!flightData || !flightData.prices) return 0;
            const priceStr = flightData.prices[selectedClass] || flightData.prices['Ekonomi'] || '0 PLN';
            return parseFloat(priceStr.replace(' PLN', '')) || 0;
        }

        let ticketPrice = calculateTicketPrice(outboundFlightData);
        if (returnFlightData) ticketPrice += calculateTicketPrice(returnFlightData);
        localStorage.setItem('ticketPrice', ticketPrice);

        // ZarzƒÖdzanie wyborem baga≈ºu
        function selectBaggage(weight, event) {
            if (event) event.stopPropagation();
            document.querySelectorAll('.price').forEach(price => price.style.display = 'none');
            document.getElementById(`price-${weight}`).style.display = 'block';
            selectExtra('baggage', weight);
        }

        // ZarzƒÖdzanie wyborem dodatkowych opcji
        function selectExtra(type, value, event) {
            if (event) event.stopPropagation();
            let selectedExtras = JSON.parse(localStorage.getItem('selectedExtras')) || {};
            if (type === 'baggage') {
                selectedExtras.baggage = value;
                document.querySelectorAll('.baggage-option').forEach(el => el.classList.remove('selected'));
                event.currentTarget.closest('.baggage-option').classList.add('selected');
            } else {
                selectedExtras[type] = selectedExtras[type] ? !selectedExtras[type] : true;
                event.currentTarget.closest('.cursor-pointer').classList.toggle('selected', selectedExtras[type]);
                document.getElementById(`price-${type}`).style.display = selectedExtras[type] ? 'block' : 'none';
            }
            localStorage.setItem('selectedExtras', JSON.stringify(selectedExtras));
            updateTotalPrice();
        }

        // Obliczanie i aktualizacja ca≈Çkowitej ceny
        function updateTotalPrice() {
            const selectedExtras = JSON.parse(localStorage.getItem('selectedExtras')) || {};
            let extraPrice = 0;
            if (selectedExtras.baggage) extraPrice += { 10: 50, 15: 75, 20: 100, 25: 125 }[selectedExtras.baggage];
            if (selectedExtras.insurance) extraPrice += 30;
            if (selectedExtras.priority) extraPrice += 20;
            if (selectedExtras.windowSeat) extraPrice += 15;
            localStorage.setItem('extraPrice', extraPrice);
        }

        // Za≈Çadowanie zapisanych opcji przy od≈õwie≈ºeniu
        window.onload = () => {
            const selectedExtras = JSON.parse(localStorage.getItem('selectedExtras')) || {};
            if (selectedExtras.baggage) {
                document.getElementById(`price-${selectedExtras.baggage}`).style.display = 'block';
                document.querySelector(`[onclick="selectExtra('baggage', ${selectedExtras.baggage})"]`).closest('.baggage-option').classList.add('selected');
            }
            ['insurance', 'priority', 'windowSeat'].forEach(type => {
                if (selectedExtras[type]) {
                    document.getElementById(`price-${type}`).style.display = 'block';
                    document.querySelector(`[onclick="selectExtra('${type}')"]`).closest('.cursor-pointer').classList.add('selected');
                }
            });
            updateTotalPrice();
        };
    </script>
</body>
</html>
